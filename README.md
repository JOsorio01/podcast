# Podcast API

Source data: https://rss.itunes.apple.com/api/v1/us/podcasts/top-podcasts/all/100/explicit.json
## Solution
* Using Jupyter Notebook to fetch data from the source URL to read the json and handle data and know the labels, where I found the main data where under the label of ‘results’ inside the ‘feed’ the principal label.
* After knowing the data to work with, I started a django project with django-rest-framework library to make the API. Started building endpoints fetching the url data to pre-process and send the required responses.
* For having data in a MySql database I built a helper endpoint that fetch data and for each podcast add it to DB each podcast have a few genres, if the genre not exist in db it creates that genre and add it to the podcast with a ManyToMany relationship – That endpoint is only for fill database purpose.

## The Code
The project has two django apps one for Podcast and Genres and the other is for Authentication, each have its own models, serializers and views, but the authentication (user) app uses the django user model. For the basic podcast CRUD I decided to use ‘viewsets’ because they have all CRUD functionality (list all objects, single object retrieve, delete and update by id) also for the group by genre wich its serializer returns each podcast with that genre. The custom endpoints like get the top 20 podcast were made with Django Class Based API Views, there is an endpoint for get the data and other for get the file.

The authentication was made with the django-rest-framework ‘authtoken’ library that requires fewer code to generate an authentication token with the Django User model. Then just add to the Class Views the variable `authentication_classes` and `permission_classes`,  the first for specify that it will use Token Authentication and the other is for require authentication to access the endpoint.

## For run the project

### Requirements:
* Python 3.7 or higher.
* Python or Anaconda virtual environment with pip
### Project structure:
```
__podcast/__
+-- __backend/__
|  +-- __api/__ (main app)
|  +-- __backend/__ (configurations)
|  +-- __user/__ (authentication app)
|  +-- .env.example (example for .env file)
|  +-- .flake8 (flake8 configuration)
|  +-- manage.py (command-line django interaction)
|  +-- podcast.sql (database backup)
+-- .gitignore
+-- README.md
+-- requirements.txt (all project dependencies)
```

## Instructions to run:
* Clone the project and with the virtual environment active enter the main folder and there is a ‘requirements.txt’ file, then run:
		`$ pip install -r requirements.txt`
	It will install django, djangorestframework, requests, mysqlclient, dotenv and flake8
* Create a mysql database with the name podcast or any name, then use the ‘podcast.sql’ file to run the database creation schema that includes tables and data.
* Create a .env file and fill it taking as example the file .env.example inside the ‘backend’ folder.
* In terminal ‘inside podcast/backend/’ run:
          `$ python manage.py runserver`
	This will run the debug server on (127.0.0.1:8000/)

## The endpoints:
### Authentication Endpoints
* 127.0.0.1:8000/api/user/create/
      Create new user. (In the database creation schema ‘podcast.sql’ includes a user named ‘usuario_prueba’ with password ‘TestPass123’.
* 127.0.0.1:8000/api/user/token/
      Returns the user token. (For using the user token add the header `Authorization` with the value `Token {the token received from this endpoint}` just like:
      
      `Token 891345a5af203ae7513581e7d296a5d2fcd26338`
  It can be used either with Postman, ModHeader (Chrome Extension), or any tool to do HTTP request.

### Podcast Endpoints (All require authentication token)

* __127.0.0.1:8000/api/podcast/ (GET, POST)__

  GET: Returns a list of all podcast. It accepts the query param ‘search’ for filter the returned podcast by `name` or `artistName`, example:

    `127.0.0.1:8000/api/podcast/?search=daily`

  POST: Create a new podcast.

* __127.0.0.1:8000/api/podcast/<id>/ (GET, PUT, PATCH)__

  GET: Return the podcast object with the provided <id>.

  PUT: Update a podcast object with the provided <id>.

  PATCH: Partialy updates object a podcast with the provided <id>.
  
* __127.0.0.1:8000/api/genre/ (GET, POST)__

  GET: Returns all podcast grouped by its genres.

* __127.0.0.1:8000/api/genre/<id>/ (GET, PUT, PATCH)__

  GET: Returns a genre with all podcast that have that genre.

  _(Like podcast, the other HTTP methods are available because they are autogenerated by Viewsets)_

* __127.0.0.1:8000/api/podcast/top20/ (GET)__ - Returns the top 20 podcast.
* __127.0.0.1:8000/api/podcast/top20.json__ - Returns a json file with the top 20 podcast.
* __127.0.0.1:8000/api/podcast/last20/ (GET)__ – Returns the bottom 20 podcast.
* __127.0.0.1:8000/api/podcast/last20.json__ - Returns a json file with the bottom 20 podcast.
      
### Old Podcast Endpoints (Not require authentication)
The data returnend by this endpoints is from the original source url using `requests`
* __127.0.0.1:8000/api/old/podcast/__
* __127.0.0.1:8000/api/old/podcast/top20/__
* __127.0.0.1:8000/api/old/podcast/top20.json__
